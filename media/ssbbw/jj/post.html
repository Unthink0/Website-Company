<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Post</title>

<style>
:root{
  --bg:#0f0f0f;
  --panel:#1c1c1c;
  --muted:#bfbfbf;
  --accent:#007aff;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--muted);
  font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  display:flex;
  justify-content:center;
}
.container{
  width:min(900px, 95%);
  margin:40px auto;
  background:var(--panel);
  border-radius:12px;
  padding:20px;
  box-shadow:0 8px 30px rgba(0,0,0,.6);
}
img{
  width:100%;
  border-radius:10px;
  margin-bottom:16px;
  object-fit:cover;
}
h1{ color:#fff; margin:0 0 8px; }
.meta{ font-size:.9rem; margin-bottom:14px; color:#ddd; }
.desc{ line-height:1.45; }

.watch-btn{
  display:inline-block;
  background:var(--accent);
  color:#fff;
  padding:14px 22px;
  border-radius:30px;
  font-weight:800;
  text-decoration:none;
  margin-top:16px;
  transition:background .2s ease, transform .2s ease;
}
.watch-btn:hover{
  background:#0091ff;
  transform:translateY(-2px);
}

.back{
  display:inline-block;
  margin-top:22px;
  color:#aaa;
  text-decoration:none;
}
.back:hover{ text-decoration:underline; }

.notice{
  padding:12px 14px;
  background:#121212;
  border:1px solid rgba(255,255,255,.10);
  border-radius:10px;
  margin-bottom:14px;
  color:#ddd;
  font-size:.95rem;
}
</style>
</head>

<body>
<div class="container">
  <div id="status" class="notice" style="display:none;"></div>
  <div id="post"></div>
</div>

<script>
const statusBox = document.getElementById("status");
const postWrap = document.getElementById("post");

function showStatus(msg){
  statusBox.style.display = "block";
  statusBox.textContent = msg;
}

function getId(){
  const params = new URLSearchParams(window.location.search);
  const raw = params.get("id");
  const id = raw ? parseInt(raw, 10) : NaN;
  return Number.isFinite(id) ? id : null;
}

async function loadPost(){
  const id = getId();
  if(id === null){
    showStatus("Missing or invalid post id. Example: post.html?id=80");
    return;
  }

  try{
    showStatus("Loading post...");
    const res = await fetch("posts.json", { cache: "no-store" });
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const posts = await res.json();

    const post = Array.isArray(posts) ? posts.find(p => p.id === id) : null;
    if(!post){
      showStatus("Post not found.");
      return;
    }

    statusBox.style.display = "none";
    document.title = post.title ?? "Post";

    const safe = (v) => (v ?? "").toString();

    postWrap.innerHTML = `
      <img src="${safe(post.image)}" alt="${safe(post.title)}">
      <h1>${safe(post.title)}</h1>
      <div class="meta">
        ${post.date ? safe(post.date) : ""}${post.category ? " • " + safe(post.category) : ""}
      </div>
      ${post.description ? `<div class="desc">${safe(post.description)}</div>` : ""}

      ${post.watchUrl ? `<a class="watch-btn" href="${safe(post.watchUrl)}" target="_blank" rel="noopener">▶ Watch Video</a>` : ""}

      <br>
      <a class="back" href="./">← Back to gallery</a>
    `;
  } catch(err){
    console.error(err);
    showStatus("Could not load posts.json. Make sure it’s in the same folder and GitHub Pages is serving it.");
  }
}

window.addEventListener("DOMContentLoaded", loadPost);
</script>

<!-- Age gate on every page -->
<script src="age-gate.js"></script>
</body>
</html>
